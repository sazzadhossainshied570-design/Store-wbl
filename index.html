<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WATER BIRDS LIMITED | ERP PRO</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { 
            --bg-color: #020617;
            --card-bg: rgba(30, 41, 59, 0.4);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #818cf8;
            --primary-glow: rgba(129, 140, 248, 0.4);
            --success: #34d399;
            --danger: #fb7185;
            --warning: #fbbf24;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg-color); 
            background-image: radial-gradient(circle at 10% 20%, rgba(129, 140, 248, 0.1) 0%, transparent 40%);
            color: var(--text-main); height: 100vh; display: flex; overflow: hidden; 
        }

        .sidebar { width: 280px; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(25px); border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 40px 25px; }
        .logo-box { padding: 25px; border-radius: 24px; background: linear-gradient(145deg, rgba(255,255,255,0.05), transparent); border: 1px solid var(--glass-border); text-align: center; }
        .logo-text { font-size: 18px; font-weight: 800; letter-spacing: 2px; color: #fff; line-height: 1.4; }
        
        .sidebar-menu { flex: 1; padding: 15px; }
        .nav-item { padding: 16px 20px; border-radius: 16px; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.3s; color: var(--text-dim); font-weight: 600; margin-bottom: 8px; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: var(--primary); color: white; box-shadow: 0 10px 25px var(--primary-glow); }

        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .top-bar { height: 90px; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; border-bottom: 1px solid var(--glass-border); }
        .content-area { padding: 40px; overflow-y: auto; flex: 1; }

        .card { background: var(--card-bg); border-radius: 28px; padding: 30px; border: 1px solid var(--glass-border); margin-bottom: 30px; backdrop-filter: blur(15px); animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-bottom: 35px; }
        .stat-card { background: rgba(255,255,255,0.02); padding: 25px; border-radius: 28px; border: 1px solid var(--glass-border); }
        .stat-card h2 { font-size: 32px; font-weight: 800; color: var(--primary); }

        .btn { border: none; padding: 12px 20px; border-radius: 12px; cursor: pointer; font-weight: 700; display: inline-flex; align-items: center; gap: 8px; transition: 0.3s; font-size: 13px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: #020617; }
        .btn-danger { background: var(--danger); color: white; }
        
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { text-align: left; padding: 12px 20px; color: var(--text-dim); font-size: 12px; text-transform: uppercase; }
        td { padding: 16px 20px; background: rgba(255,255,255,0.03); color: var(--text-main); font-size: 14px; }
        td:first-child { border-radius: 14px 0 0 14px; }
        td:last-child { border-radius: 0 14px 14px 0; }

        .low-stock { color: var(--warning) !important; font-weight: 700; background: rgba(251, 191, 36, 0.1) !important; }
        .out-of-stock { color: var(--danger) !important; font-weight: 800; background: rgba(251, 113, 133, 0.1) !important; }

        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid var(--glass-border); border-radius: 14px; background: rgba(0,0,0,0.3); color: white; outline: none; }
        .search-box { width: 220px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); }

        .tab-page { display: none; }
        .tab-page.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        iframe#print-frame { display: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <div class="logo-box"><div class="logo-text">WATER BIRDS<br><span style="color:var(--primary)">LIMITED</span></div></div>
    </div>
    <div class="sidebar-menu">
        <div class="nav-item active" onclick="showTab('dashboard')"><i class="fas fa-th-large"></i> Dashboard</div>
        <div class="nav-item" onclick="showTab('entry')"><i class="fas fa-edit"></i> Stock Entry</div>
        <div class="nav-item" onclick="showTab('inventory')"><i class="fas fa-boxes"></i> Inventory</div>
        <div class="nav-item" onclick="showTab('logs')"><i class="fas fa-history"></i> Stock Logs</div>
        <div class="nav-item" id="nav-settings" style="display:none;" onclick="showTab('settings')"><i class="fas fa-cog"></i> Settings</div>
    </div>
    <div style="padding: 20px;"><button id="logout-btn" class="btn btn-danger" style="width:100%; display:none;" onclick="logoutProfile()">Logout</button></div>
</div>

<div class="main">
    <div class="top-bar">
        <div id="display-name" style="font-weight:700;">Guest Mode</div>
        <div style="color: var(--success); font-weight: 700; font-size: 12px;"><i class="fas fa-circle"></i> SERVER ONLINE</div>
    </div>

    <div class="content-area">
        <div id="dashboard" class="tab-page active">
            <div class="stats-grid">
                <div class="stat-card"><p>Total Items</p><h2 id="stat-total-items">0</h2></div>
                <div class="stat-card"><p>Total In</p><h2 id="stat-total-in">0</h2></div>
                <div class="stat-card"><p>Total Out</p><h2 id="stat-total-out">0</h2></div>
            </div>
            <div id="login-section" class="card" style="max-width: 400px; margin: 0 auto; text-align: center;">
                <h3>System Login</h3>
                <select id="userSelect">
                    <option value="">Select User</option>
                    <option value="Sazzad Hossain">Sazzad Hossain</option>
                    <option value="Rokibul Islam">Rokibul Islam</option>
                    <option value="Mobin Bin Mihad">Mobin Bin Mihad</option>
                    <option value="Md.alamin">Md.alamin</option>
                </select>
                <input type="password" id="userPin" placeholder="Enter PIN">
                <button class="btn btn-primary" style="width: 100%;" onclick="loginProfile()">Login</button>
            </div>
            <div id="admin-controls" class="card" style="display:none; border: 1px dashed var(--danger);">
                <button class="btn btn-danger" onclick="resetAllData()">Reset Database</button>
            </div>
        </div>

        <div id="entry" class="tab-page">
            <div id="entry-container" style="display:none; grid-template-columns: 1fr 1fr; gap:25px;">
                <div class="card">
                    <h3>Vessel Entry</h3>
                    <select id="pName">
                        <option value="10×35 pressure vessel">10×35 pressure vessel</option>
                        <option value="12×52 pressure vessel">12×52 pressure vessel</option>
                        <option value="16×65 pressure vessel">16×65 pressure vessel</option>
                    </select>
                    <input type="number" id="pQty" placeholder="Quantity">
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-success" style="flex:1" onclick="processStock('pName', 'pQty', 'IN', 'VESSEL')">IN</button>
                        <button class="btn btn-danger" style="flex:1" onclick="processStock('pName', 'pQty', 'OUT', 'VESSEL')">OUT</button>
                    </div>
                </div>
                <div class="card">
                    <h3>Store Accessories</h3>
                    <select id="accName">
                        <option value="Ethanol">Ethanol</option>
                        <option value="Cartoon tep">Cartoon tep</option>
                        <option value="Hand Globs">Hand Globs</option>
                        <option value="Ruller brush 9 inch">Ruller brush 9"</option>
                        <option value="Paint brush 2 inch">Paint brush 2"</option>
                        <option value="Ruller Hendel">Ruller Hendel</option>
                        <option value="Fom disk">Fom disk</option>
                        <option value="Eaticing disk">Eaticing disk</option>
                        <option value="Mask">Mask</option>
                        <option value="Rapping Polly">Rapping Polly</option>
                        <option value="Revit">Revit</option>
                        <option value="Thut">Thut</option>
                        <option value="Cutting disk">Cutting disk</option>
                        <option value="Entry cutter">Entry cutter</option>
                        <option value="Fhinishing bled">Fhinishing bled</option>
                        <option value="Control Valve">Control Valve</option>
                        <option value="Strainer">Strainer</option>
                        <option value="Riser Pipe">Riser Pipe</option>
                    </select>
                    <input type="number" id="accQty" placeholder="Quantity">
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-success" style="flex:1" onclick="processStock('accName', 'accQty', 'IN', 'ACC')">IN</button>
                        <button class="btn btn-danger" style="flex:1" onclick="processStock('accName', 'accQty', 'OUT', 'ACC')">OUT</button>
                    </div>
                </div>
            </div>
            <div id="entry-locked" class="card" style="text-align:center;">Login to unlock entry</div>
        </div>

        <div id="inventory" class="tab-page">
            <div class="card">
                <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Vessel Stock</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" class="search-box" id="invVesselSearch" placeholder="Search..." onkeyup="filterTable('vesselTable', 0, this.value)">
                        <button class="btn btn-primary" onclick="downloadExcel('vesselTable')">Excel</button>
                        <button class="btn btn-danger" onclick="printTable('vesselTable', 'VESSEL STOCK')">PDF</button>
                    </div>
                </div>
                <table id="vesselTable"><thead><tr><th>Item</th><th>Balance</th></tr></thead><tbody></tbody></table>
            </div>
            <div class="card">
                <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Accessories Stock</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" class="search-box" id="invAccSearch" placeholder="Search..." onkeyup="filterTable('accTable', 0, this.value)">
                        <button class="btn btn-primary" onclick="downloadExcel('accTable')">Excel</button>
                        <button class="btn btn-danger" onclick="printTable('accTable', 'ACC STOCK')">PDF</button>
                    </div>
                </div>
                <table id="accTable"><thead><tr><th>Item</th><th>Balance</th></tr></thead><tbody></tbody></table>
            </div>
        </div>

        <div id="logs" class="tab-page">
            <div class="card">
                <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Vessel History</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" class="search-box" id="vLogSearch" placeholder="Search..." onkeyup="filterTable('vesselLogTable', 1, this.value)">
                        <button class="btn btn-primary" onclick="downloadExcel('vesselLogTable')">Excel</button>
                        <button class="btn btn-danger" onclick="printTable('vesselLogTable', 'VESSEL LOGS')">PDF</button>
                    </div>
                </div>
                <table id="vesselLogTable"><thead><tr><th>Time</th><th>Item</th><th>Qty</th><th>Type</th><th>User</th></tr></thead><tbody></tbody></table>
            </div>
            <div class="card">
                <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Accessories History</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" class="search-box" id="aLogSearch" placeholder="Search..." onkeyup="filterTable('accLogTable', 1, this.value)">
                        <button class="btn btn-primary" onclick="downloadExcel('accLogTable')">Excel</button>
                        <button class="btn btn-danger" onclick="printTable('accLogTable', 'ACC LOGS')">PDF</button>
                    </div>
                </div>
                <table id="accLogTable"><thead><tr><th>Time</th><th>Item</th><th>Qty</th><th>Type</th><th>User</th></tr></thead><tbody></tbody></table>
            </div>
        </div>
    </div>
</div>

<iframe id="print-frame"></iframe>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCv_lbDM4K5C79TB-P4EOIWVUgi9qHfNaE",
        authDomain: "waterbirdserp.firebaseapp.com",
        databaseURL: "https://waterbirdserp-default-rtdb.firebaseio.com",
        projectId: "waterbirdserp",
        storageBucket: "waterbirdserp.firebasestorage.app",
        messagingSenderId: "799606239136",
        appId: "1:799606239136:web:a07cb470d45f240817fec5"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let USERS_LIST = { "Sazzad Hossain": "866199", "Rokibul Islam": "1122", "Mobin Bin Mihad": "1122", "Md.alamin": "1122" };
    let loggedInUser = null;

    function showTab(id) {
        document.querySelectorAll('.tab-page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        const nav = document.querySelector(`.nav-item[onclick*="${id}"]`);
        if(nav) nav.classList.add('active');
    }

    function loginProfile() {
        const name = document.getElementById('userSelect').value;
        const pin = document.getElementById('userPin').value;
        if (USERS_LIST[name] === pin) {
            loggedInUser = name;
            document.getElementById('display-name').innerText = name;
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('entry-container').style.display = 'grid';
            document.getElementById('entry-locked').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'block';
            if(name === "Sazzad Hossain") document.getElementById('admin-controls').style.display = 'block';
            showTab('dashboard');
        } else alert("Wrong PIN!");
    }

    function logoutProfile() { location.reload(); }

    function processStock(nameId, qtyId, type, category) {
        const name = document.getElementById(nameId).value;
        const qty = parseInt(document.getElementById(qtyId).value);
        if(!name || isNaN(qty) || qty <= 0) return alert("Valid data please!");
        const path = category === 'VESSEL' ? 'vessels/' : 'accessories/';
        const dbRef = database.ref('inventory/' + path + name.replace(/\s+/g, '_').replace(/\./g, '-'));
        dbRef.transaction(curr => (type === 'IN' ? (curr || 0) + qty : (curr || 0) - qty), (err, commit) => {
            if(commit) {
                database.ref('logs').push({ name, qty, type, category, user: loggedInUser, time: new Date().toLocaleString() });
                document.getElementById(qtyId).value = '';
                alert("✅ Success!");
            }
        });
    }

    database.ref('inventory').on('value', snap => {
        const data = snap.val() || {};
        const vBody = document.querySelector('#vesselTable tbody');
        const aBody = document.querySelector('#accTable tbody');
        vBody.innerHTML = ''; aBody.innerHTML = '';
        let count = 0;
        const addRow = (body, k, v) => {
            let cls = v <= 0 ? "out-of-stock" : (v <= 5 ? "low-stock" : "");
            body.innerHTML += `<tr><td>${k.replace(/_/g,' ')}</td><td class="${cls}">${v}</td></tr>`;
        };
        if(data.vessels) Object.keys(data.vessels).forEach(k => { addRow(vBody, k, data.vessels[k]); count++; });
        if(data.accessories) Object.keys(data.accessories).forEach(k => { addRow(aBody, k, data.accessories[k]); count++; });
        document.getElementById('stat-total-items').innerText = count;
    });

    database.ref('logs').on('value', snap => {
        const logs = snap.val() || {};
        const vLog = document.querySelector('#vesselLogTable tbody');
        const aLog = document.querySelector('#accLogTable tbody');
        vLog.innerHTML = ''; aLog.innerHTML = '';
        let tIn = 0, tOut = 0;
        Object.values(logs).reverse().forEach(l => {
            const row = `<tr><td>${l.time}</td><td>${l.name}</td><td>${l.qty}</td><td>${l.type}</td><td>${l.user}</td></tr>`;
            if(l.category === 'VESSEL') vLog.innerHTML += row; else aLog.innerHTML += row;
            if(l.type === 'IN') tIn += l.qty; else tOut += l.qty;
        });
        document.getElementById('stat-total-in').innerText = tIn;
        document.getElementById('stat-total-out').innerText = tOut;
    });

    function filterTable(id, col, val) {
        const rows = document.getElementById(id).getElementsByTagName("tr");
        for (let i = 1; i < rows.length; i++) {
            rows[i].style.display = rows[i].cells[col].innerText.toLowerCase().includes(val.toLowerCase()) ? "" : "none";
        }
    }

    function downloadExcel(id) {
        const rows = Array.from(document.getElementById(id).rows).filter(r => r.style.display !== "none");
        const nt = document.createElement("table");
        rows.forEach(r => nt.appendChild(r.cloneNode(true)));
        XLSX.writeFile(XLSX.utils.table_to_book(nt), `WaterBirds_${id}.xlsx`);
    }

    function printTable(id, title) {
        const rows = Array.from(document.getElementById(id).rows).filter(r => r.style.display !== "none");
        let html = ""; rows.forEach(r => html += r.outerHTML);
        const win = document.getElementById('print-frame').contentWindow;
        win.document.open();
        win.document.write(`<html><head><style>table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px;}</style></head><body><h2>${title}</h2><table>${html}</table></body></html>`);
        win.document.close();
        setTimeout(() => { win.focus(); win.print(); }, 500);
    }

    function resetAllData() {
        if(prompt("PIN:") === "866199") { database.ref('inventory').remove(); database.ref('logs').remove(); location.reload(); }
    }
</script>
</body>
</html>
